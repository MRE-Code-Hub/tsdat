pipeline:
  type: Ingest
  location_id: "test"
  dataset_name: "SortedDataset"
  data_level: "a1"

dataset_definition:
  attributes:
    institution: PNNL
    title: "Surface Meteorological Measurements and Ocean Current Measurements from Buoy #130 at Morro Bay, CA"

  dimensions:
    time:
      length: unlimited
  
  variable_defaults:
    dims: [time]
    type: float

  variables:
    time:
      input:
        name: TimeString
        converter:
          classname: tsdat.utils.converters.StringTimeConverter
          parameters:
            timezone: UTC
            time_format: "%Y%m%d %H%M%S"
      dims: [time]
      type: long
      attrs:
        units: seconds since 1970-01-01T00:00:00
    
    height_in:
      input:
        name: InHeight(m)
      attrs:
        units: m

    height_out:
      input:
        name: InHeight(m)
        units: m
      attrs:
        units: km
        warn_range: [0.0, 1.0]
        fail_range: [0.0, 1.5]
        valid_range: [-2.0, 6.0]
        valid_delta: 6.0

    uninitialized_var:
      dims: [time]
      type: float

    static_dimensionless_var:
      data: 0.42
      dims: []



quality_management:

  manage_coordinate_monotonicity:
    checker:
      classname: tsdat.qc.checkers.CheckMonotonic
    handlers:
      - classname: tsdat.qc.handlers.SortDatasetByCoordinate
    variables:
      - COORDS

  manage_missing_values:
    checker:
      classname: tsdat.qc.checkers.CheckMissing
    handlers:
      - classname: tsdat.qc.handlers.RemoveFailedValues
        correction: Missing or NaN values were replaced with _FillValue
      - classname: tsdat.qc.handlers.RecordQualityResults
        parameters:
          bit: 1
          assessment: Bad
          meaning: "Value is equal to _FillValue or NaN"
    variables:
      - DATA_VARS
    # exclude:
    #   - static_dimensionless_var

  manage_warn_min:
    checker:
      classname: tsdat.qc.checkers.CheckWarnMin
    handlers:
      - classname: tsdat.qc.handlers.RecordQualityResults
        parameters:
          bit: 2
          assessment: Indeterminate
          meaning: "Value is less than warn_range"
    variables:
      - height_out

  manage_warn_max:
    checker:
      classname: tsdat.qc.checkers.CheckWarnMax
    handlers:
      - classname: tsdat.qc.handlers.RecordQualityResults
        parameters:
          bit: 3
          assessment: Indeterminate
          meaning: "Value is greater than warn_range"
    variables:
      - height_out

  manage_fail_min:
    checker:
      classname: tsdat.qc.checkers.CheckFailMin
    handlers:
      - classname: tsdat.qc.handlers.RecordQualityResults
        parameters:
          bit: 2
          assessment: Bad
          meaning: "Value is less than fail_range"
    variables:
      - height_out

  manage_fail_max:
    checker:
      classname: tsdat.qc.checkers.CheckFailMax
    handlers:
      - classname: tsdat.qc.handlers.RecordQualityResults
        parameters:
          bit: 3
          assessment: Bad
          meaning: "Value is greater than fail_range"
    variables:
      - height_out

  manage_valid_min:
    checker:
      classname: tsdat.qc.checkers.CheckValidMin
    handlers:
      - classname: tsdat.qc.handlers.RecordQualityResults
        parameters:
          bit: 2
          assessment: Bad
          meaning: "Value is less than valid_range"
    variables:
      - height_out

  manage_valid_max:
    checker:
      classname: tsdat.qc.checkers.CheckValidMax
    handlers:
      - classname: tsdat.qc.handlers.RecordQualityResults
        parameters:
          bit: 3
          assessment: Bad
          meaning: "Value is greater than valid_range"
    variables:
      - height_out

  manage_valid_delta:
    checker:
      classname: tsdat.qc.checkers.CheckValidDelta
    handlers:
      - classname: tsdat.qc.handlers.RecordQualityResults
        parameters:
          bit: 4
          assessment: Bad
          meaning: "Value delta is greater than valid_delta"
    variables:
      - height_out